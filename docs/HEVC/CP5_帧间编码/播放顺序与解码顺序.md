# 播放顺序与解码顺序

## 1 概述

### 1.1 播放顺序与解码顺序

视频中图片的播放顺序是指**图片在视频播放时呈现在屏幕上的先后顺序**，也代表了视频本身的时间顺序，而视频的解码顺序则是指**图片从码流中恢复重建的先后顺序**。

在 HEVC 中，**由于双向参考帧的存在，图片的播放顺序与解码顺序可能会发生改变**。当双向参考帧参考播放顺序位于其后的图片时，这个被参考的图片需要先解码，然后才能解码双向参考帧，这就会导致播放顺序与解码顺序不同。

### 1.2 示意图

HEVC 解码顺序、播放顺序与参考序列的关系如下图所示

![播放顺序与解码顺序_12128](markdown_images/%E6%92%AD%E6%94%BE%E9%A1%BA%E5%BA%8F%E4%B8%8E%E8%A7%A3%E7%A0%81%E9%A1%BA%E5%BA%8F_12128.png)

**POC**（picture order count）为**图像的实际播放顺序**（数值小的先播放），Decoding order 为**解码顺序**（数值小的先解码），**RPS**（reference picture set）为**图像解码需要参考的图像集合，**由图可知**由于双向预测帧的存在，图像的解码顺序与播放顺序有时并不相同**

### 1.3 实验结果

#### 1.3.1 不存在双向预测帧

在 HM 中使用 `encoder_lowdelay_P_main10.cfg` 配置文件，只使用 I slice 和 P slice 进行编码，此时不存在双向预测，实验结果如下（从上到下为编码顺序，POC 为播放顺序）

![播放顺序与解码顺序_60192](markdown_images/%E6%92%AD%E6%94%BE%E9%A1%BA%E5%BA%8F%E4%B8%8E%E8%A7%A3%E7%A0%81%E9%A1%BA%E5%BA%8F_60192.png)

可以看到此时**编码顺序与播放顺序相同**

#### 1.3.2 存在双向预测帧

在 HM 中使用 `encoder_randomaccess_main10.cfg` 配置文件，只使用 I slice 和 B slice 进行编码，此时存在具有后向参考的双向预测，实验结果如下

![播放顺序与解码顺序_78272](markdown_images/%E6%92%AD%E6%94%BE%E9%A1%BA%E5%BA%8F%E4%B8%8E%E8%A7%A3%E7%A0%81%E9%A1%BA%E5%BA%8F_78272.png)

可以看到此时**编码顺序与播放顺序不同**，在本次实验中以 16 张图片为一组（也就是 GOP（Group Of Picture）为 16），先编码图片 0 和 16，然后再编码 0 和 16 图片中间的图片 8，再编码 0 和 8 中间的图片 4，如此递归式地进行编码操作
