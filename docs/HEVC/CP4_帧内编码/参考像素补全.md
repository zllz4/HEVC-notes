# 参考像素补全

## 1 像素补全规则

### 1.1 概述

参考像素补全是参考像素获取操作的**第一步**，HEVC 采用的参考像素是在 TU 周围左侧、左下侧、左上侧、上侧、右上侧**一格宽度**的像素，如下图，这些参考像素可能**跨越多个 TU**，当遇到图片边缘、slice 边缘等情况可能会出现参考像素值的缺失，此时需要进行参考像素的补全操作

![参考像素补全_68032](markdown_images/%E5%8F%82%E8%80%83%E5%83%8F%E7%B4%A0%E8%A1%A5%E5%85%A8_68032.png)

图中灰色部分是参考像素，白色矩形区是待预测的 TU，白色部分 TU 的左上端点的坐标记为 $p[0][0]$，往右往下坐标增大，往左往上坐标减小，TU 左侧参考点坐标记为 $p[-1][y]$，TU 上侧参考点坐标记为 $p[x][-1]$

### 1.2 补全规则

像素补全的基本规则如下

![参考像素补全_54976](markdown_images/%E5%8F%82%E8%80%83%E5%83%8F%E7%B4%A0%E8%A1%A5%E5%85%A8_54976.png)

![参考像素补全_57792](markdown_images/%E5%8F%82%E8%80%83%E5%83%8F%E7%B4%A0%E8%A1%A5%E5%85%A8_57792.png)

对上图的解释：p[-1][2N-1] 按照顺时针找到第一个可用的参考像素，然后 p[-1][2N-2] 参考 p[-1][2N-1]，p[-1][2N-3] 参考 p[-1][2N-2]，...，p[-1][-1] 参考 p[-1][-2]，p[0][-1] 参考 p[-1][-1]，p[N-1][-1] 参考 p[N-2][-1]，最后 p[2N-1][-1] 参考 p[2N-2][-1]

> "参考" 也可理解为 "由...替代"

如果所有参考点均不存在，那么**将参考像素的大小设置为像素大小允许取值范围的中间值**（8bit 填 128，10bit 填 512）