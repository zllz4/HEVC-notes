# 后处理滤波

## 1 滤波规则

### 1.1 概述

后处理滤波是帧内编码的最后一个步骤。

一些预测模式会**在 TU 块边缘产生明显的不连续现象，尤其是 DC 模式以及水平和垂直模式**，当采用垂直模式时，左侧边缘可能不连续（因为根本没参考左侧像素），当采用水平模式时，上侧边缘可能不连续（因为根本没参考上侧像素），当采用 DC 模式时，左侧和上侧边缘都可能不连续，因此当**大小小于 32x32 的 TU 采用 DC、10 或 26 预测模式**时，将**对其亮度分量**进行后处理滤波

### 1.2 规则

后处理滤波的具体规则如下

![后处理滤波_5114181632](markdown_images/%E5%90%8E%E5%A4%84%E7%90%86%E6%BB%A4%E6%B3%A2_5114181632.png)

当帧内预测采用垂直模式（模式 26）时，后处理滤波依照式 4.21 进行，对于所有位于待预测 TU 亮度 TB 左侧边缘的像素 P（$p[0][y]$），将其修改为 $P'=P+\frac{B-A}{2}$，B 为 P 正左侧的参考像素，A 为 $p[-1][-1]$。当帧内预测采用水平模式（模式 10）时，依照同样方法进行，只不过 B 改为 TB 上边缘的像素 P 正上方的参考像素。

![后处理滤波_8370547712](markdown_images/%E5%90%8E%E5%A4%84%E7%90%86%E6%BB%A4%E6%B3%A2_8370547712.png)

当帧内预测采用 DC 模式时，对于 $p[0][0]$ 也就是 A 点，其被替换为 $\frac{C+2A+B}{4}$ 的四舍五入取整（即采用 [1 2 1]/4 滤波器），对于其它左侧和上侧的 TU 边缘点 P，其被替换为 $\frac{3P+RP}{4}$ 的四舍五入取整（即采用 [3 1]/4 滤波器），$RP$ 就是 P 正对的那个参考像素

![后处理滤波_2553294848](markdown_images/%E5%90%8E%E5%A4%84%E7%90%86%E6%BB%A4%E6%B3%A2_2553294848.png)

> 这波感觉上像是让边缘像素与相邻的参考像素更加接近？