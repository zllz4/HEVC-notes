# 编解码流程

## 1 基本流程

### 1.1 流程示意图

HEVC 编码基本流程示意图如下（图来自 [HEVC] 章节中提到的英文书）

![编解码流程_1589051392](markdown_images/%E7%BC%96%E8%A7%A3%E7%A0%81%E6%B5%81%E7%A8%8B_1589051392.png)

### 1.2 流程概述

HEVC 的具体流程为首先对图片进行 CTU 级别的**分块操作**，然后以块为单位对图片进行帧内、帧间（以及 CU、PU、TU 级别分块）的**模式决策**，通过**率失真损失** PK 出最佳的模式，使用最佳的模式进行**帧内或帧间编码**得到**预测像素**，块**原始像素**减去**预测像素**得到残差。将残差进行**DCT变换**、**量化**得到量化后的 DCT 系数，该系数通过熵编码后作为该视频的编码结果输出。同时，为了支持预测编码，编码器内部还会进行解码操作，拿解码后的**重建像素**作为之后块的预测参考。解码操作会将量化后的 DCT 系数进行**反量化**和**反 DCT 变换**得到**重建残差**，原预测像素加上重建残差得到**重建像素（环路滤波前）**，这个重建像素会作为之后块的**帧内**预测的参考像素，同时重建像素经过**环路滤波**（Deblock、SAO）得到**重建像素（环路滤波后）**，这个滤波后的重建像素会拿来作为之后帧**帧间**预测的参考像素。真正解码时，环路滤波后的重建像素也会用作**显示**输出。

编码器的输出主要是量化后的 DCT 系数，其它预测编码、变换量化、环路滤波、全局控制模块也会有一些信息需要熵编码后输出，这些输出结果共同组成了最终编码产生的二进制文件。

## 2 补充笔记

### 2.1 混合编码

HEVC 使用**基于块的混合编码技术**，混合是指其同时使用了**预测编码**和**变换编码**的技术，预测编码指其**利用时域和空域的邻近像素预测当前像素值，之后传输实际值与预测值之差（残差）**，变换编码指其**对残差执行了 DCT 变换，传输其量化后的非零 DCT 系数**

混合编码 百度百科: [[地址](https://baike.baidu.com/item/混合编码)]

预测编码 维基百科: [[地址](https://zh.wikipedia.org/wiki/預測編碼)]

变换编码 维基百科: [[地址](https://zh.wikipedia.org/wiki/变换编码)]